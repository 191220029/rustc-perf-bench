# 2021-08-17 Triage Log

TODO: Summary

Triage done by **@???**.
Revision range: [6b20506d17f4e5e5bf5bcad7e94add4d754b0ae3..aa8f27bf4d980023a8b245ceb25a490a18041eb2](https://perf.rust-lang.org/?start=6b20506d17f4e5e5bf5bcad7e94add4d754b0ae3&end=aa8f27bf4d980023a8b245ceb25a490a18041eb2&absolute=false&stat=instructions%3Au)
59 comparisons made in total

2 Regressions, 1 Improvements, 4 Mixed; ??? of them in rollups

#### Regressions

encode `generics_of` for fields and ty params [#87815](https://github.com/rust-lang/rust/issues/87815)
- Moderate regression in [instruction counts](https://perf.rust-lang.org/compare.html?start=2d10c2a3302d53e10a4ad3ac581103faaae9eeb6&end=c4c2986c499ee9440b7ae23bf5a62c6168e1ce17&stat=instructions:u) (up to 1.2% on `incr-unchanged` builds of `diesel`)


Various refactorings of the TAIT infrastructure [#87587](https://github.com/rust-lang/rust/issues/87587)
- Moderate regression in [instruction counts](https://perf.rust-lang.org/compare.html?start=47b41b7788a6f85c749049062f1e4eed497cd894&end=d488de82f30fd1dcb0220d57498638596622394e&stat=instructions:u) (up to 1.5% on `full` builds of `inflate`)


#### Improvements

Avoid using the `copy_nonoverlapping` wrapper through `mem::replace`. [#87827](https://github.com/rust-lang/rust/issues/87827)
- Large improvement in [instruction counts](https://perf.rust-lang.org/compare.html?start=e8c25f266349a68faa8c4fb68f5c1d5e4512790f&end=4e886d68766719a7fc1714c52a0e7e81929e8b8e&stat=instructions:u) (up to -2.2% on `incr-patched: u8 3072` builds of `issue-46449`)


#### Mixed

LLVM codegen: Don't emit zero-sized padding for fields [#87254](https://github.com/rust-lang/rust/issues/87254)
- Moderate improvement in [instruction counts](https://perf.rust-lang.org/compare.html?start=e8e1b32a7840c07f30c04b252c379a044a73902d&end=47b41b7788a6f85c749049062f1e4eed497cd894&stat=instructions:u) (up to -1.3% on `full` builds of `ctfe-stress-4`)
- Large regression in [instruction counts](https://perf.rust-lang.org/compare.html?start=e8e1b32a7840c07f30c04b252c379a044a73902d&end=47b41b7788a6f85c749049062f1e4eed497cd894&stat=instructions:u) (up to 4.6% on `full` builds of `deep-vector`)


Run RemoveZsts pass at mir-opt-level=1 [#83417](https://github.com/rust-lang/rust/issues/83417)
- Large improvement in [instruction counts](https://perf.rust-lang.org/compare.html?start=e55c13e1099b78b1a485202fabc9c1b10b1f1d15&end=8007b506ac5da629f223b755f5a5391edd5f6d01&stat=instructions:u) (up to -4.3% on `incr-unchanged` builds of `deeply-nested-async`)
- Moderate regression in [instruction counts](https://perf.rust-lang.org/compare.html?start=e55c13e1099b78b1a485202fabc9c1b10b1f1d15&end=8007b506ac5da629f223b755f5a5391edd5f6d01&stat=instructions:u) (up to 0.8% on `full` builds of `tokio-webpush-simple`)


Introduce `hir::ExprKind::Let` - Take 2 [#80357](https://github.com/rust-lang/rust/issues/80357)
- Large improvement in [instruction counts](https://perf.rust-lang.org/compare.html?start=2bd17c1d43bba43412cc2f051323a279d6751e43&end=2a6fb9a4c0e5ca7a81999065943b211c226fe9d8&stat=instructions:u) (up to -2.1% on `incr-patched: println` builds of `webrender`)
- Moderate regression in [instruction counts](https://perf.rust-lang.org/compare.html?start=2bd17c1d43bba43412cc2f051323a279d6751e43&end=2a6fb9a4c0e5ca7a81999065943b211c226fe9d8&stat=instructions:u) (up to 0.7% on `full` builds of `cranelift-codegen`)


BTree: merge the complication introduced by #81486 and #86031 [#87696](https://github.com/rust-lang/rust/issues/87696)
- Small improvement in [instruction counts](https://perf.rust-lang.org/compare.html?start=2a6fb9a4c0e5ca7a81999065943b211c226fe9d8&end=23461b210f1b0a121592a18fc4fb666106006668&stat=instructions:u) (up to -0.6% on `full` builds of `issue-46449`)
- Moderate regression in [instruction counts](https://perf.rust-lang.org/compare.html?start=2a6fb9a4c0e5ca7a81999065943b211c226fe9d8&end=23461b210f1b0a121592a18fc4fb666106006668&stat=instructions:u) (up to 1.7% on `full` builds of `ripgrep`)


#### Probably changed

The following is a list of comparisons which *probably* represent real performance changes,
but we're not 100% sure. Please move things from this category into the categories
above for changes you think *are* definitely relevant and file an issue for each so that
we can consider how to change our heuristics.


Rollup of 14 pull requests [#87923](https://github.com/rust-lang/rust/issues/87923)
- Small improvement in [instruction counts](https://perf.rust-lang.org/compare.html?start=ae90dcf0207c57c3034f00b07048d63f8b2363c8&end=e8e1b32a7840c07f30c04b252c379a044a73902d&stat=instructions:u) (up to -0.4% on `incr-unchanged` builds of `ripgrep`)
- Small regression in [instruction counts](https://perf.rust-lang.org/compare.html?start=ae90dcf0207c57c3034f00b07048d63f8b2363c8&end=e8e1b32a7840c07f30c04b252c379a044a73902d&stat=instructions:u) (up to 0.3% on `incr-full` builds of `deeply-nested-closures`)


Make deleted code in a suggestion clearer [#86532](https://github.com/rust-lang/rust/issues/86532)
- Small improvement in [instruction counts](https://perf.rust-lang.org/compare.html?start=362e0f55eb1f36d279e5c4a58fb0fe5f9a2c579d&end=ccffcafd55e58f769d4b0efc0064bf65e76998e4&stat=instructions:u) (up to -0.2% on `full` builds of `regex`)
- Small regression in [instruction counts](https://perf.rust-lang.org/compare.html?start=362e0f55eb1f36d279e5c4a58fb0fe5f9a2c579d&end=ccffcafd55e58f769d4b0efc0064bf65e76998e4&stat=instructions:u) (up to 0.4% on `incr-patched: println` builds of `regression-31157`)


TryReserveErrorKind tests and inline [#87843](https://github.com/rust-lang/rust/issues/87843)
- Small improvement in [instruction counts](https://perf.rust-lang.org/compare.html?start=ccffcafd55e58f769d4b0efc0064bf65e76998e4&end=25d3e14da77f755ef858b976a25c7e856b62b42a&stat=instructions:u) (up to -0.4% on `full` builds of `deeply-nested`)
- Small regression in [instruction counts](https://perf.rust-lang.org/compare.html?start=ccffcafd55e58f769d4b0efc0064bf65e76998e4&end=25d3e14da77f755ef858b976a25c7e856b62b42a&stat=instructions:u) (up to 1.2% on `incr-patched: println` builds of `coercions`)


Plugin interface cleanup [#85296](https://github.com/rust-lang/rust/issues/85296)
- Small improvement in [instruction counts](https://perf.rust-lang.org/compare.html?start=25d3e14da77f755ef858b976a25c7e856b62b42a&end=eb2226b1f174f3cc644275ef8663be6295a7f704&stat=instructions:u) (up to -0.3% on `incr-full` builds of `inflate`)
- Small regression in [instruction counts](https://perf.rust-lang.org/compare.html?start=25d3e14da77f755ef858b976a25c7e856b62b42a&end=eb2226b1f174f3cc644275ef8663be6295a7f704&stat=instructions:u) (up to 1.3% on `incr-patched: println` builds of `coercions`)


Rollup of 7 pull requests [#87948](https://github.com/rust-lang/rust/issues/87948)
- Moderate improvement in [instruction counts](https://perf.rust-lang.org/compare.html?start=eb2226b1f174f3cc644275ef8663be6295a7f704&end=4e900176b6c402035a6e52da03d453c848f0b336&stat=instructions:u) (up to -2.6% on `incr-patched: println` builds of `coercions`)
- Small regression in [instruction counts](https://perf.rust-lang.org/compare.html?start=eb2226b1f174f3cc644275ef8663be6295a7f704&end=4e900176b6c402035a6e52da03d453c848f0b336&stat=instructions:u) (up to 0.5% on `incr-patched: println` builds of `regression-31157`)


Implement `black_box` using intrinsic [#87916](https://github.com/rust-lang/rust/issues/87916)
- Small improvement in [instruction counts](https://perf.rust-lang.org/compare.html?start=4498e300e41f47c75abe4e49ec91ae949aaeea5f&end=0fa3190394475a84360b34e074e719d519bc40f1&stat=instructions:u) (up to -0.4% on `full` builds of `helloworld`)
- Small regression in [instruction counts](https://perf.rust-lang.org/compare.html?start=4498e300e41f47c75abe4e49ec91ae949aaeea5f&end=0fa3190394475a84360b34e074e719d519bc40f1&stat=instructions:u) (up to 0.4% on `incr-patched: add vec item` builds of `deep-vector`)


Name the captured upvars for closures/generators in debuginfo [#85020](https://github.com/rust-lang/rust/issues/85020)
- Large regression in [instruction counts](https://perf.rust-lang.org/compare.html?start=c6094fc7b9981d755abeb8c0e866a0f6315b3ec3&end=99efc51dae1dbe9d741707a7ddef84c29e654df5&stat=instructions:u) (up to 4.9% on `incr-patched: println` builds of `webrender-wrench`)


Try filtering out non-const impls when we expect const impls [#87375](https://github.com/rust-lang/rust/issues/87375)
- Small regression in [instruction counts](https://perf.rust-lang.org/compare.html?start=fa2692990c05652c7823c8d2afae501a00a69050&end=136eaa1b25d13635b773a481ecab61a3162cb627&stat=instructions:u) (up to 0.4% on `full` builds of `diesel`)


Uplift the invalid_atomic_ordering lint from clippy to rustc [#84039](https://github.com/rust-lang/rust/issues/84039)
- Moderate regression in [instruction counts](https://perf.rust-lang.org/compare.html?start=23461b210f1b0a121592a18fc4fb666106006668&end=92f3753b073c03184118a315cc0d289116102ae1&stat=instructions:u) (up to 0.7% on `incr-unchanged` builds of `unicode_normalization`)


Add future-incompat lint for `doc(primitive)` [#87050](https://github.com/rust-lang/rust/issues/87050)
- Small improvement in [instruction counts](https://perf.rust-lang.org/compare.html?start=73d96b090bb68065cd3a469b27cbd568e39bf0e7&end=0035d9dcecee49d1f7349932bfa52c05a6f83641&stat=instructions:u) (up to -0.3% on `incr-unchanged` builds of `webrender-wrench`)
- Small regression in [instruction counts](https://perf.rust-lang.org/compare.html?start=73d96b090bb68065cd3a469b27cbd568e39bf0e7&end=0035d9dcecee49d1f7349932bfa52c05a6f83641&stat=instructions:u) (up to 0.3% on `incr-unchanged` builds of `helloworld`)


Include (potentially remapped) working dir in crate hash [#87990](https://github.com/rust-lang/rust/issues/87990)
- Small improvement in [instruction counts](https://perf.rust-lang.org/compare.html?start=0e41c6201f7a3f1823b3b668da61577d89bf76d4&end=a183141e2d0f0af7f12946ff1a81615fa35e8099&stat=instructions:u) (up to -0.3% on `incr-unchanged` builds of `deeply-nested-closures`)
- Small regression in [instruction counts](https://perf.rust-lang.org/compare.html?start=0e41c6201f7a3f1823b3b668da61577d89bf76d4&end=a183141e2d0f0af7f12946ff1a81615fa35e8099&stat=instructions:u) (up to 0.3% on `full` builds of `regression-31157`)


#### Untriaged Pull Requests

- [#87640 Rollup of 9 pull requests](https://github.com/rust-lang/rust/pull/87640)
- [#87587 Various refactorings of the TAIT infrastructure](https://github.com/rust-lang/rust/pull/87587)
- [#87244 Better diagnostics with mismatched types due to implicit static lifetime](https://github.com/rust-lang/rust/pull/87244)
- [#86777 Include terminators in instance size estimate](https://github.com/rust-lang/rust/pull/86777)
- [#86698 Move OnDiskCache to rustc_query_impl.](https://github.com/rust-lang/rust/pull/86698)
- [#86588 Rollup of 8 pull requests](https://github.com/rust-lang/rust/pull/86588)
- [#86034 Change entry point to 🛡️ against 💥 💥-payloads](https://github.com/rust-lang/rust/pull/86034)
- [#84560 Inline Iterator as IntoIterator.](https://github.com/rust-lang/rust/pull/84560)

#### Nags requiring follow up

TODO: Nags

